# Hbase Export Snapshot
A custom asynchronous oozie action to export Hbase snapshots.

## Install
In order to manually install this custom action on a
[BACH](https://github.com/bloomberg/chef-bach) cluster:

Install maven 3.3 or higher
```
wget http://mirrors.sonic.net/apache/maven/maven-3/3.3.3/binaries/apache-maven-3.3.3-bin.tar.gz
tar -zxf apache-maven-3.3.3-bin.tar.gz
sudo cp -R apache-maven-3.3.3 /usr/local
sudo ln -s /usr/local/apache-maven-3.3.3/bin/mvn /usr/bin/mvn
mvn -version
```


Build the project into a jar:
```
$ mvn package
```
Copy the file in `target/hbaseoozie-1.0-SNAPSHOT.jar` to
`/usr/hdp/current/oozie-server/libext/hbaseoozie-1.0-SNAPSHOT.jar` on the node
where the oozie server is installed.

Edit the `/etc/oozie/conf/oozie-site.xml` file adding the following lines:
```
    <property>
       <name>oozie.service.ActionService.executor.ext.classes</name>
       <value>
         org.apache.oozie.action.email.EmailActionExecutor,
         org.apache.oozie.action.hadoop.HiveActionExecutor,
         org.apache.oozie.action.hadoop.ShellActionExecutor,
         org.apache.oozie.action.hadoop.SqoopActionExecutor,
-        org.apache.oozie.action.hadoop.DistcpActionExecutor
+        org.apache.oozie.action.hadoop.DistcpActionExecutor,
+        com.bloomberg.hbase.oozieactions.HbaseExportSnapshotActionExecutor,
+        com.bloomberg.hbase.oozieactions.HbaseImportSnapshotActionExecutor
       </value>
     </property>

     <property>
       <name>oozie.service.SchemaService.wf.ext.schemas</name>
       <value>
         shell-action-0.1.xsd,
         shell-action-0.2.xsd,
         shell-action-0.3.xsd,
         email-action-0.1.xsd,
         hive-action-0.2.xsd,
         hive-action-0.3.xsd,
         hive-action-0.4.xsd,
         hive-action-0.5.xsd,
         sqoop-action-0.2.xsd,
         sqoop-action-0.3.xsd,
         ssh-action-0.1.xsd,
         ssh-action-0.2.xsd,
-        distcp-action-0.1.xsd
+        distcp-action-0.1.xsd,
+        hbase-export-snapshot-action-0.1.xsd,
+        hbase-import-snapshot-action-0.1.xsd
       </value>
     </property>
```

If you care about logging, you should add the following line to the end of `/etc/oozie/conf/oozie-log4j.properties`:
```
log4j.logger.com.bloomberg.hbase.oozieactions=ALL, oozie
```
This will make all log trace generated by the custom actions available in the oozie logs.

Then stop oozie:
```
$ sudo service oozie stop
```

Rebuild the oozie war:
```
$ /usr/hdp/current/oozie-server/bin/oozie-setup.sh prepare-war
```

Start oozie:
```
$ sudo service oozie start
```
